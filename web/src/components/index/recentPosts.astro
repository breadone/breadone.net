---
import SummaryCard from "./summaryCard.astro";
import { authPB } from "@utils/pocketbase";
import { getFormattedDate } from "@utils/date";

const pb = await authPB()

const posts = await pb.collection('posts').getList(1, 3, {
	sort: '-publishDate',
    filter: 'published=true',
})

const postImages = await Promise.all( posts.items.map(p => pb.files.getURL(p, p.headerImage)) )

---
<SummaryCard
    title="Recent Posts",
    titleLink="/posts"
>
    <div class="flex flex-col md:flex-row gap-4 md:gap-4">
        {
            posts.items.map((p, i) => (
            <div class="flex md:flex-col flex-row gap-3 md:gap-2 flex-1">
                <time class="hidden md:block text-sm text-gray-500" datetime={p.publishDate}>{getFormattedDate(p.publishDate)}</time>
                <a href={`/posts/${p.slug}`} class="shrink-0">
                    <img class="w-24 h-24 md:w-full md:h-48 object-cover rounded-sm" src={postImages[i]} alt={p.title}/>
                </a>

                <div class="flex flex-col justify-start md:justify-start">
                    <a href={`/posts/${p.slug}`} class="b1-no-underline line-clamp-2 md:line-clamp-none">
                        {p.title}
                    </a>
                    <time class="md:hidden text-sm text-gray-5020" datetime={p.publishDate}>{getFormattedDate(p.publishDate)}</time>
                </div>
            </div>
            ))
        }
    </div>
</SummaryCard>